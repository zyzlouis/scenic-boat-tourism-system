

# 景区游船计时收费系统 - 产品需求文档 (PRD)

| **文档版本** | **V1.0**                                                     |
| ------------ | ------------------------------------------------------------ |
| **文档状态** | 草稿 (Draft)                                                 |
| **撰写人**   | PM Partner                                                   |
| **对应项目** | 景区游船数字化改造 MVP                                       |
| **主要目标** | 解决人工计时混乱、排队拥堵问题，实现收银与计时的数字化闭环。 |

## 1. 项目背景与价值 (Background & Value Proposition)

- **背景：** 当前景区游船租赁采用“人工售票+手写计时+人工退押金”的模式，导致旺季码头拥堵，且人工计算时长易出错，客诉率高。
- **核心价值：**
  - **对游客：** 购票透明，计时准确，退押金自动化，减少排队。
  - **对运营：** 降低人工计算成本，通过“扫码核销”提升翻台率。
- **MVP原则：** 本期不涉及硬件改造（IoT），不接入信用免押，优先跑通“购票-核销-计时-结算”的软件闭环。

## 2. 用户角色 (User Roles)

| **角色**        | **描述**                | **核心诉求**                                             |
| --------------- | ----------------------- | -------------------------------------------------------- |
| **游客**        | 租船的终端用户          | 快速购票、透明计费、押金秒退。                           |
| **码头核销员**  | 负责发船/收船的工作人员 | 操作极简（一键扫码）、能快速处理异常（如游客手机没电）。 |
| **财务/管理员** | 景区管理者              | 灵活配置价格（如节假日涨价）、账目清晰。                 |

## 3. 业务流程 (Business Logic)

1. **购票：** 游客扫码进入小程序 -> 选择船型 -> 支付【基础票价+押金】 -> 生成核销码。
2. **发船：** 游客出示核销码 -> 员工扫码 -> **输入/选择船号(可选，非必须，最后开发)** -> 系统开启计时 -> 闸机放行/员工放行。
3. **游玩：** 游客手机端显示“计时中”，展示已用时长及预计费用。
4. **收船：** 游客靠岸 -> 员工再次扫码（或输入船号） -> 系统停止计时。
5. **结算：** 系统自动判断是否超时 -> 计算最终费用 -> 原路退还剩余押金 -> 订单完成。

## 4. 功能需求清单 (Functional Requirements)

### 4.1 用户端 (微信小程序)

| **优先级** | **功能模块** | **功能点** | **需求描述**                                                 |
| ---------- | ------------ | ---------- | ------------------------------------------------------------ |
| **P0**     | **商品页**   | 船型选择   | 展示有动力/无动力船列表。必须清晰展示：起步价、包含时长、**押金金额**、超时费率。 |
| **P0**     | **下单流程** | 支付与押金 | 支持微信支付。订单总额 = 基础门票费 + 押金。支付成功后跳转至订单详情。 |
| **P0**     | **订单详情** | 核销凭证   | 生成动态二维码（核销码）。状态流转：待核销 -> 计时中 -> 已完成/已退款。 |
| **P0**     | **订单详情** | 计时看板   | 当状态为“计时中”时，实时刷新显示：开始时间、已用时长、**预计超时费用**（高亮提醒）。 |
| **P1**     | **消息通知** | 服务通知   | 计时开始、结束、退款成功时，需推送微信服务通知。             |

### 4.2 员工端 (核销App/管理版小程序)

| **优先级** | **功能模块** | **功能点**   | **需求描述**                                                 |
| ---------- | ------------ | ------------ | ------------------------------------------------------------ |
| **P0**     | **工作台**   | 扫码核销     | 核心功能。支持连续扫码。                                     |
| **P0**     | **核销逻辑** | **发船绑定** | 扫码（第一次）后，必须弹出“输入船号”弹窗（如 E-001），确认后开始计时。 |
| **P0**     | **核销逻辑** | **收船结算** | 扫码（第二次）后，展示账单预览（时长、扣费金额），点击“确认结束”完成订单。 |
| **P1**     | **订单管理** | 船号反查     | 支持直接输入“船号”查找订单。**场景：** 游客手机没电或屏幕损坏，无法出示二维码，员工直接问船号来结束订单。 |
| **P1**     | **异常处理** | 强制结束     | 对于恶意不归还或遗忘处理的订单，支持管理员权限强制结束计费。 |

### 4.3 管理后台 (Web端)

| **优先级** | **功能模块** | **功能点** | **需求描述**                                                 |
| ---------- | ------------ | ---------- | ------------------------------------------------------------ |
| **P0**     | **计费配置** | 价格策略   | 支持配置：基础价格、包含分钟数、**押金金额**、超时单价（元/分钟）、封顶金额。 |
| **P1**     | **计费配置** | 日历价格   | 支持按日期设置不同价格方案（如：平日价、周末价、黄金周价）。 |
| **P0**     | **财务报表** | 对账单     | 每日实收金额、押金退款总额、超时费总额统计。                 |

## 5. 非功能需求 (Non-functional Requirements)

- **网络鲁棒性：** 考虑到景区湖面信号可能不稳定，员工端在扫码时若网络超时，需有明确的Toast提示，严禁出现“转圈卡死”导致游客积压。
- **并发性能：** 支持黄金周高峰期（如并发 QPS 100+）的扫码请求，确保计费开始/结束的延迟在 2秒以内。
- **数据一致性：** 涉及资金结算，必须确保“支付状态”与“订单状态”强一致，杜绝“押金已退但订单未结束”的Bug。