# å‘˜å·¥ç«¯å°ç¨‹åºä¿®å¤è¯´æ˜

## ä¿®å¤çš„é—®é¢˜

### 1. WXML è¯­æ³•é”™è¯¯ âŒ â†’ âœ…

**é”™è¯¯ä¿¡æ¯ï¼š**
```
[ WXML æ–‡ä»¶ç¼–è¯‘é”™è¯¯] /pages/orders/orders.wxml
Bad value with message: unexpected ">" at pos20.
route__ is not defined
```

**æ ¹æœ¬åŸå› ï¼š**
åœ¨ WXML ä¸­ä½¿ç”¨äº†ä¸æ”¯æŒçš„ JavaScript è¯­æ³•ï¼š
```xml
<!-- âŒ é”™è¯¯å†™æ³• -->
{{orders.filter(item => item.isOvertime).length}}
```

**ä¿®å¤æ–¹æ¡ˆï¼š**
1. åœ¨ JS ä¸­é¢„å…ˆè®¡ç®—è¶…æ—¶è®¢å•æ•°é‡
2. å°†è®¡ç®—ç»“æœå­˜å‚¨åœ¨ data ä¸­
3. WXML ç›´æ¥ä½¿ç”¨è®¡ç®—å¥½çš„å€¼

```javascript
// âœ… æ­£ç¡®å†™æ³• - JS
data: {
  overtimeCount: 0
}

loadOrders() {
  const overtimeCount = orders.filter(item => item.isOvertime).length;
  this.setData({ overtimeCount });
}
```

```xml
<!-- âœ… æ­£ç¡®å†™æ³• - WXML -->
{{overtimeCount}}
```

---

### 2. WXML ä¸­æ— æ³•è°ƒç”¨ JS å‡½æ•° âŒ â†’ âœ…

**é”™è¯¯ï¼š**
```xml
<!-- âŒ é”™è¯¯å†™æ³• -->
{{formatTime(item.startTime)}}
{{formatDuration(item.usedMinutes)}}
```

**ä¿®å¤æ–¹æ¡ˆï¼š**
ä½¿ç”¨ WXS æ¨¡å—ï¼š

```xml
<!-- âœ… æ­£ç¡®å†™æ³• -->
<wxs module="filters" src="../../utils/filters.wxs"></wxs>

{{filters.formatTime(item.startTime)}}
{{filters.formatDuration(item.usedMinutes)}}
```

---

### 3. ä½¿ç”¨æ—§ API æ–¹å¼ âŒ â†’ âœ…

**æ—§ä»£ç ï¼š**
```javascript
// âŒ ä½¿ç”¨ä¼ ç»Ÿ HTTP è¯·æ±‚
const api = require('../../utils/api');
const res = await api.get('/verification/pending');
```

**æ–°ä»£ç ï¼š**
```javascript
// âœ… ä½¿ç”¨äº‘å¼€å‘
const cloud = require('../../utils/cloud');
const res = await cloud.getPendingOrders();
```

---

## ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### 1. `client-staff/pages/orders/orders.js`
- âœ… æ·»åŠ  `overtimeCount` å­—æ®µ
- âœ… åœ¨ `loadOrders()` ä¸­è®¡ç®—è¶…æ—¶è®¢å•æ•°é‡
- âœ… å°† `api.get()` æ”¹ä¸º `cloud.getPendingOrders()`
- âœ… å°† `api.post()` æ”¹ä¸º `cloud.endTrip()`

### 2. `client-staff/pages/orders/orders.wxml`
- âœ… æ·»åŠ  WXS æ¨¡å—å¯¼å…¥
- âœ… å°†ç®­å¤´å‡½æ•°æ”¹ä¸ºä½¿ç”¨ `overtimeCount`
- âœ… æ‰€æœ‰æ ¼å¼åŒ–å‡½æ•°æ”¹ä¸º `filters.xxx()`

### 3. `client-staff/utils/filters.wxs` (æ–°å¢)
- âœ… ä» client-user å¤åˆ¶ filters.wxs
- âœ… åŒ…å«æ ¼å¼åŒ–å‡½æ•°ï¼šformatMoney, formatTime, formatDuration, getOrderStatusText, getOrderStatusColor

---

## æµ‹è¯•æ­¥éª¤

### ç¬¬1æ­¥ï¼šé‡æ–°ç¼–è¯‘
1. å…³é—­å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. é‡æ–°æ‰“å¼€é¡¹ç›®
3. ç‚¹å‡»ã€ç¼–è¯‘ã€‘æŒ‰é’®
4. ç¡®ä¿æ§åˆ¶å°æ²¡æœ‰çº¢è‰²é”™è¯¯

### ç¬¬2æ­¥ï¼šéªŒè¯ orders é¡µé¢
1. è¿›å…¥ã€å¾…å¤„ç†è®¢å•ã€‘é¡µé¢
2. æ£€æŸ¥æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
3. æ£€æŸ¥é¡¶éƒ¨ç»Ÿè®¡ï¼ˆè®¡æ—¶ä¸­ã€å·²è¶…æ—¶ï¼‰æ˜¯å¦æ­£å¸¸

### ç¬¬3æ­¥ï¼šéªŒè¯å®Œæ•´æµç¨‹
```
å‘˜å·¥ç™»å½• â†’ æ‰«ææ ¸é”€ç  â†’ å‘èˆ¹ â†’ æŸ¥çœ‹è®¢å•åˆ—è¡¨ â†’ æ”¶èˆ¹
```

---

## å…¶ä»–å¯èƒ½éœ€è¦ä¿®å¤çš„é¡µé¢

æ ¹æ®ä»£ç ç»“æ„ï¼Œè¿˜æœ‰ä¸¤ä¸ªé¡µé¢å¯èƒ½éœ€è¦ç±»ä¼¼ä¿®å¤ï¼š

### 1. `pages/scan/scan.wxml`
æ£€æŸ¥æ˜¯å¦æœ‰ï¼š
- [ ] ç›´æ¥è°ƒç”¨ JS å‡½æ•°
- [ ] ä½¿ç”¨ç®­å¤´å‡½æ•°æˆ–å¤æ‚è¡¨è¾¾å¼

### 2. `pages/search/search.wxml`
æ£€æŸ¥æ˜¯å¦æœ‰ï¼š
- [ ] ç›´æ¥è°ƒç”¨ JS å‡½æ•°
- [ ] ä½¿ç”¨ç®­å¤´å‡½æ•°æˆ–å¤æ‚è¡¨è¾¾å¼

**å¦‚æœè¿™ä¸¤ä¸ªé¡µé¢ä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜ï¼Œéœ€è¦åŒæ ·çš„ä¿®å¤æ–¹å¼ã€‚**

---

## æŠ€æœ¯è¯´æ˜

### WXML çš„é™åˆ¶

**ä¸æ”¯æŒçš„è¯­æ³•ï¼š**
- âŒ ç®­å¤´å‡½æ•°ï¼š`item => item.value`
- âŒ Array æ–¹æ³•ï¼š`array.filter()`, `array.map()`, `array.reduce()`
- âŒ è°ƒç”¨ JS data ä¸­çš„å‡½æ•°ï¼š`{{myFunction(param)}}`
- âŒ å¤æ‚è¡¨è¾¾å¼ï¼š`{{a > b ? c : d}}`ï¼ˆç®€å•ä¸‰å…ƒå¯ä»¥ï¼‰

**æ”¯æŒçš„è¯­æ³•ï¼š**
- âœ… ç®€å•å±æ€§è®¿é—®ï¼š`{{item.name}}`
- âœ… ç®€å•è¿ç®—ï¼š`{{a + b}}`, `{{a > b}}`
- âœ… WXS æ¨¡å—å‡½æ•°ï¼š`{{filters.formatMoney(amount)}}`

### WXS vs JS

| ç‰¹æ€§ | WXS | JS |
|------|-----|-----|
| è¿è¡Œç¯å¢ƒ | WXML è§†å›¾å±‚ | é€»è¾‘å±‚ |
| è°ƒç”¨æ–¹å¼ | `{{filters.xxx()}}` | `this.xxx()` |
| æ”¯æŒåº“ | æœ‰é™ | å®Œæ•´ Node.js |
| æ€§èƒ½ | æ›´å¿«ï¼ˆè§†å›¾å±‚ç›´æ¥è°ƒç”¨ï¼‰ | éœ€è¦è·¨å±‚é€šä¿¡ |
| é€‚ç”¨åœºæ™¯ | æ•°æ®æ ¼å¼åŒ–ã€ç®€å•è®¡ç®— | å¤æ‚ä¸šåŠ¡é€»è¾‘ |

---

## å¸¸è§é”™è¯¯å¯¹ç…§è¡¨

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|------|----------|
| `unexpected ">" at pos20` | ç®­å¤´å‡½æ•° `=>` | åœ¨ JS ä¸­è®¡ç®—æˆ–ä½¿ç”¨ WXS |
| `route__ is not defined` | ä½¿ç”¨äº†ä¸æ”¯æŒçš„ JS ç‰¹æ€§ | æ£€æŸ¥å¹¶ç§»é™¤ç®­å¤´å‡½æ•°ã€filter ç­‰ |
| `xxx is not a function` | åœ¨ WXML ä¸­è°ƒç”¨ JS å‡½æ•° | æ”¹ç”¨ WXS æ¨¡å— |
| `Cannot read property 'xxx'` | æ•°æ®æœªå®šä¹‰ | æ£€æŸ¥ data åˆå§‹åŒ– |

---

## ä¸‹ä¸€æ­¥å·¥ä½œ

âœ… **å·²å®Œæˆï¼š**
1. ä¿®å¤ orders é¡µé¢è¯­æ³•é”™è¯¯
2. æ”¹ç”¨äº‘å¼€å‘æ–¹å¼
3. æ·»åŠ  WXS æ¨¡å—æ”¯æŒ

ğŸ”² **å¾…å®Œæˆï¼š**
1. æ£€æŸ¥ scan.wxml å’Œ search.wxml æ˜¯å¦æœ‰ç±»ä¼¼é—®é¢˜
2. æµ‹è¯•å®Œæ•´çš„å‘˜å·¥ç«¯æµç¨‹
3. éªŒè¯ä¸ç”¨æˆ·ç«¯çš„è”åŠ¨

---

**æœ€åæ›´æ–°ï¼š** 2025-02-05 01:30
