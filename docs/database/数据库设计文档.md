# 景区游船计时收费系统 - 数据库设计文档

| **文档版本** | **V1.0**                     |
| ------------ | ---------------------------- |
| **文档状态** | 设计中 (In Design)           |
| **撰写人**   | 数据库架构师                 |
| **创建时间** | 2026-02-04                   |
| **数据库**   | MySQL 8.0                    |

---

## 1. 数据库设计原则

1. **数据一致性优先**: 涉及资金交易，必须保证数据强一致性
2. **范式设计**: 遵循第三范式，减少数据冗余
3. **索引优化**: 在高频查询字段上建立索引
4. **字段命名**: 使用小写下划线命名法（snake_case）
5. **时间字段**: 统一使用 DATETIME 类型，存储 UTC 时间
6. **软删除**: 重要数据表采用软删除（is_deleted 字段）
7. **审计字段**: 每张表都包含 created_at、updated_at 字段

---

## 2. 数据库 ER 图（文字描述）

### 核心实体关系

```
User (用户) 1 ------ N Orders (订单)
                     │
                     │ 1
                     │
                     N
                  Payments (支付记录)
                     │
                     │ 1
                     │
                     0..N
                  Refunds (退款记录)

Order (订单) N ------ 1 BoatType (船型)
             │
             │ 1
             │
             0..1
          Boat (船只)

Order (订单) 1 ------ N VerificationLog (核销记录)
             │
             │ 1
             │
             0..1
          TimingRecord (计时记录)

Staff (员工) 1 ------ N VerificationLog (核销记录)

BoatType (船型) 1 ------ N PricingConfig (价格配置)
```

---

## 3. 数据表设计

### 3.1 用户表 (users)

**表描述**: 存储微信小程序用户信息

| 字段名       | 类型         | 长度 | 允许NULL | 默认值 | 索引 | 说明                                  |
| ------------ | ------------ | ---- | -------- | ------ | ---- | ------------------------------------- |
| id           | BIGINT       | -    | NO       | -      | PK   | 用户ID，主键，自增                    |
| open_id      | VARCHAR      | 128  | NO       | -      | UNI  | 微信 OpenID，唯一索引                 |
| union_id     | VARCHAR      | 128  | YES      | NULL   | IDX  | 微信 UnionID（如果有公众号绑定）      |
| nickname     | VARCHAR      | 64   | YES      | NULL   | -    | 微信昵称                              |
| avatar_url   | VARCHAR      | 512  | YES      | NULL   | -    | 微信头像URL                           |
| phone        | VARCHAR      | 20   | YES      | NULL   | IDX  | 手机号（绑定后）                      |
| is_vip       | TINYINT      | 1    | NO       | 0      | -    | 是否VIP会员（0:否, 1:是）             |
| is_deleted   | TINYINT      | 1    | NO       | 0      | -    | 软删除标记（0:未删除, 1:已删除）      |
| created_at   | DATETIME     | -    | NO       | -      | -    | 创建时间                              |
| updated_at   | DATETIME     | -    | NO       | -      | -    | 更新时间                              |

**索引**:
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_open_id` (`open_id`)
- KEY `idx_phone` (`phone`)
- KEY `idx_created_at` (`created_at`)

---

### 3.2 船型配置表 (boat_types)

**表描述**: 船只类型配置（有动力/无动力）

| 字段名       | 类型         | 长度 | 允许NULL | 默认值 | 索引 | 说明                                  |
| ------------ | ------------ | ---- | -------- | ------ | ---- | ------------------------------------- |
| id           | INT          | -    | NO       | -      | PK   | 船型ID，主键，自增                    |
| type_code    | VARCHAR      | 32   | NO       | -      | UNI  | 船型编码（powered/unpowered）         |
| type_name    | VARCHAR      | 64   | NO       | -      | -    | 船型名称（有动力船/无动力船）         |
| description  | VARCHAR      | 256  | YES      | NULL   | -    | 船型描述                              |
| max_capacity | INT          | -    | NO       | 4      | -    | 最大载客量（人数）                    |
| image_url    | VARCHAR      | 512  | YES      | NULL   | -    | 船型图片URL                           |
| sort_order   | INT          | -    | NO       | 0      | -    | 排序顺序（数字越小越靠前）            |
| is_active    | TINYINT      | 1    | NO       | 1      | -    | 是否启用（0:禁用, 1:启用）            |
| is_deleted   | TINYINT      | 1    | NO       | 0      | -    | 软删除标记                            |
| created_at   | DATETIME     | -    | NO       | -      | -    | 创建时间                              |
| updated_at   | DATETIME     | -    | NO       | -      | -    | 更新时间                              |

**索引**:
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_type_code` (`type_code`)

**初始数据**:
```sql
INSERT INTO boat_types (type_code, type_name, description, max_capacity, sort_order, is_active) VALUES
('powered', '有动力船', '配有电动马达，速度较快，适合远距离游玩', 4, 1, 1),
('unpowered', '无动力船', '脚踏或手划，速度较慢，适合悠闲游湖', 2, 2, 1);
```

---

### 3.3 价格配置表 (pricing_config)

**表描述**: 船型价格配置（支持按日期配置不同价格）

| 字段名            | 类型         | 长度   | 允许NULL | 默认值 | 索引 | 说明                                  |
| ----------------- | ------------ | ------ | -------- | ------ | ---- | ------------------------------------- |
| id                | INT          | -      | NO       | -      | PK   | 价格配置ID，主键，自增                |
| boat_type_id      | INT          | -      | NO       | -      | IDX  | 关联船型ID                            |
| price_name        | VARCHAR      | 64     | NO       | -      | -    | 价格方案名称（平日价/周末价）         |
| base_price        | DECIMAL      | (10,2) | NO       | -      | -    | 基础门票价格（元）                    |
| deposit_amount    | DECIMAL      | (10,2) | NO       | -      | -    | 押金金额（元）                        |
| included_minutes  | INT          | -      | NO       | 60     | -    | 包含时长（分钟）                      |
| overtime_rate     | DECIMAL      | (10,2) | NO       | -      | -    | 超时费率（元/分钟）                   |
| cap_amount        | DECIMAL      | (10,2) | YES      | NULL   | -    | 封顶金额（元），NULL表示不封顶        |
| effective_date    | DATE         | -      | YES      | NULL   | IDX  | 生效日期（NULL表示默认价格）          |
| expiry_date       | DATE         | -      | YES      | NULL   | -    | 失效日期（NULL表示长期有效）          |
| is_default        | TINYINT      | 1      | NO       | 0      | -    | 是否默认价格（0:否, 1:是）            |
| is_active         | TINYINT      | 1      | NO       | 1      | -    | 是否启用（0:禁用, 1:启用）            |
| is_deleted        | TINYINT      | 1      | NO       | 0      | -    | 软删除标记                            |
| created_at        | DATETIME     | -      | NO       | -      | -    | 创建时间                              |
| updated_at        | DATETIME     | -      | NO       | -      | -    | 更新时间                              |

**索引**:
- PRIMARY KEY (`id`)
- KEY `idx_boat_type` (`boat_type_id`)
- KEY `idx_effective_date` (`effective_date`, `expiry_date`)

**初始数据示例**:
```sql
-- 有动力船平日价
INSERT INTO pricing_config VALUES (
  NULL, 1, '有动力船-平日价', 50.00, 100.00, 60, 1.00, 200.00,
  NULL, NULL, 1, 1, 0, NOW(), NOW()
);

-- 无动力船平日价
INSERT INTO pricing_config VALUES (
  NULL, 2, '无动力船-平日价', 30.00, 50.00, 60, 0.50, 100.00,
  NULL, NULL, 1, 1, 0, NOW(), NOW()
);
```

---

### 3.4 船只表 (boats)

**表描述**: 实体船只信息（每艘船的编号、状态）

| 字段名       | 类型         | 长度 | 允许NULL | 默认值 | 索引 | 说明                                        |
| ------------ | ------------ | ---- | -------- | ------ | ---- | ------------------------------------------- |
| id           | INT          | -    | NO       | -      | PK   | 船只ID，主键，自增                          |
| boat_number  | VARCHAR      | 32   | NO       | -      | UNI  | 船号（E-001, E-002...）唯一                 |
| boat_type_id | INT          | -    | NO       | -      | IDX  | 关联船型ID                                  |
| status       | VARCHAR      | 20   | NO       | idle   | IDX  | 状态（idle:空闲, in_use:使用中, maintenance:维护中） |
| last_used_at | DATETIME     | -    | YES      | NULL   | -    | 最后使用时间                                |
| is_active    | TINYINT      | 1    | NO       | 1      | -    | 是否启用（0:禁用, 1:启用）                  |
| is_deleted   | TINYINT      | 1    | NO       | 0      | -    | 软删除标记                                  |
| created_at   | DATETIME     | -    | NO       | -      | -    | 创建时间                                    |
| updated_at   | DATETIME     | -    | NO       | -      | -    | 更新时间                                    |

**索引**:
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_boat_number` (`boat_number`)
- KEY `idx_boat_type` (`boat_type_id`)
- KEY `idx_status` (`status`)

**初始数据示例**:
```sql
-- 有动力船（E-001 ~ E-020）
INSERT INTO boats (boat_number, boat_type_id, status) VALUES
('E-001', 1, 'idle'), ('E-002', 1, 'idle'), ... ('E-020', 1, 'idle');

-- 无动力船（P-001 ~ P-030）
INSERT INTO boats (boat_number, boat_type_id, status) VALUES
('P-001', 2, 'idle'), ('P-002', 2, 'idle'), ... ('P-030', 2, 'idle');
```

---

### 3.5 订单表 (orders)

**表描述**: 核心业务表，记录每笔租船订单

| 字段名              | 类型         | 长度   | 允许NULL | 默认值  | 索引 | 说明                                        |
| ------------------- | ------------ | ------ | -------- | ------- | ---- | ------------------------------------------- |
| id                  | BIGINT       | -      | NO       | -       | PK   | 订单ID，主键，自增                          |
| order_no            | VARCHAR      | 32     | NO       | -       | UNI  | 订单号（唯一，如：ORD20260204123456789）    |
| user_id             | BIGINT       | -      | NO       | -       | IDX  | 关联用户ID                                  |
| boat_type_id        | INT          | -      | NO       | -       | IDX  | 关联船型ID                                  |
| boat_id             | INT          | -      | YES      | NULL    | IDX  | 关联船只ID（发船后绑定）                    |
| pricing_config_id   | INT          | -      | NO       | -       | -    | 关联价格配置ID（记录订单创建时的价格快照）  |
| base_price          | DECIMAL      | (10,2) | NO       | -       | -    | 基础票价（元）                              |
| deposit_amount      | DECIMAL      | (10,2) | NO       | -       | -    | 押金金额（元）                              |
| included_minutes    | INT          | -      | NO       | 60      | -    | 包含时长（分钟）                            |
| overtime_rate       | DECIMAL      | (10,2) | NO       | -       | -    | 超时费率（元/分钟）                         |
| total_amount        | DECIMAL      | (10,2) | NO       | -       | -    | 订单总额（基础票价+押金）                   |
| verification_code   | VARCHAR      | 64     | YES      | NULL    | UNI  | 核销码（支付成功后生成）                    |
| status              | VARCHAR      | 20     | NO       | pending | IDX  | 订单状态（见下方状态说明）                  |
| start_time          | DATETIME     | -      | YES      | NULL    | -    | 开始计时时间（发船时间）                    |
| end_time            | DATETIME     | -      | YES      | NULL    | -    | 结束计时时间（收船时间）                    |
| used_minutes        | INT          | -      | YES      | NULL    | -    | 实际使用时长（分钟）                        |
| overtime_minutes    | INT          | -      | YES      | NULL    | -    | 超时时长（分钟）                            |
| overtime_fee        | DECIMAL      | (10,2) | YES      | NULL    | -    | 超时费用（元）                              |
| refund_amount       | DECIMAL      | (10,2) | YES      | NULL    | -    | 退款金额（元）                              |
| final_amount        | DECIMAL      | (10,2) | YES      | NULL    | -    | 最终支付金额（元）                          |
| remark              | VARCHAR      | 512    | YES      | NULL    | -    | 备注（异常情况说明等）                      |
| is_deleted          | TINYINT      | 1      | NO       | 0       | -    | 软删除标记                                  |
| created_at          | DATETIME     | -      | NO       | -       | IDX  | 创建时间                                    |
| updated_at          | DATETIME     | -      | NO       | -       | -    | 更新时间                                    |
| completed_at        | DATETIME     | -      | YES      | NULL    | -    | 完成时间                                    |

**订单状态说明**:
- `pending`: 待支付
- `paid`: 已支付，待核销
- `verified`: 已核销，待发船
- `timing`: 计时中（游玩中）
- `ended`: 已结束计时，待结算
- `completed`: 已完成（已退款）
- `cancelled`: 已取消
- `timeout`: 超时异常（超过24小时未收船）

**索引**:
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_order_no` (`order_no`)
- UNIQUE KEY `uk_verification_code` (`verification_code`)
- KEY `idx_user_id` (`user_id`)
- KEY `idx_boat_type_id` (`boat_type_id`)
- KEY `idx_boat_id` (`boat_id`)
- KEY `idx_status` (`status`)
- KEY `idx_created_at` (`created_at`)

---

### 3.6 支付记录表 (payments)

**表描述**: 记录所有支付流水（对接微信支付）

| 字段名              | 类型         | 长度   | 允许NULL | 默认值  | 索引 | 说明                                        |
| ------------------- | ------------ | ------ | -------- | ------- | ---- | ------------------------------------------- |
| id                  | BIGINT       | -      | NO       | -       | PK   | 支付记录ID，主键，自增                      |
| order_id            | BIGINT       | -      | NO       | -       | IDX  | 关联订单ID                                  |
| payment_no          | VARCHAR      | 64     | NO       | -       | UNI  | 支付流水号（自生成）                        |
| transaction_id      | VARCHAR      | 64     | YES      | NULL    | UNI  | 微信支付交易号（回调后更新）                |
| amount              | DECIMAL      | (10,2) | NO       | -       | -    | 支付金额（元）                              |
| payment_method      | VARCHAR      | 32     | NO       | wechat  | -    | 支付方式（wechat:微信支付）                 |
| status              | VARCHAR      | 20     | NO       | pending | IDX  | 支付状态（pending/success/failed）          |
| paid_at             | DATETIME     | -      | YES      | NULL    | -    | 支付完成时间                                |
| callback_data       | TEXT         | -      | YES      | NULL    | -    | 微信支付回调数据（JSON）                    |
| remark              | VARCHAR      | 512    | YES      | NULL    | -    | 备注                                        |
| created_at          | DATETIME     | -      | NO       | -       | -    | 创建时间                                    |
| updated_at          | DATETIME     | -      | NO       | -       | -    | 更新时间                                    |

**索引**:
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_payment_no` (`payment_no`)
- UNIQUE KEY `uk_transaction_id` (`transaction_id`)
- KEY `idx_order_id` (`order_id`)
- KEY `idx_status` (`status`)

---

### 3.7 退款记录表 (refunds)

**表描述**: 记录所有退款流水

| 字段名              | 类型         | 长度   | 允许NULL | 默认值  | 索引 | 说明                                        |
| ------------------- | ------------ | ------ | -------- | ------- | ---- | ------------------------------------------- |
| id                  | BIGINT       | -      | NO       | -       | PK   | 退款记录ID，主键，自增                      |
| order_id            | BIGINT       | -      | NO       | -       | IDX  | 关联订单ID                                  |
| payment_id          | BIGINT       | -      | NO       | -       | IDX  | 关联支付记录ID                              |
| refund_no           | VARCHAR      | 64     | NO       | -       | UNI  | 退款流水号（自生成）                        |
| refund_id           | VARCHAR      | 64     | YES      | NULL    | UNI  | 微信退款单号（回调后更新）                  |
| refund_amount       | DECIMAL      | (10,2) | NO       | -       | -    | 退款金额（元）                              |
| refund_reason       | VARCHAR      | 256    | YES      | NULL    | -    | 退款原因                                    |
| status              | VARCHAR      | 20     | NO       | pending | IDX  | 退款状态（pending/success/failed）          |
| refunded_at         | DATETIME     | -      | YES      | NULL    | -    | 退款完成时间                                |
| callback_data       | TEXT         | -      | YES      | NULL    | -    | 微信退款回调数据（JSON）                    |
| remark              | VARCHAR      | 512    | YES      | NULL    | -    | 备注                                        |
| created_at          | DATETIME     | -      | NO       | -       | -    | 创建时间                                    |
| updated_at          | DATETIME     | -      | NO       | -       | -    | 更新时间                                    |

**索引**:
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_refund_no` (`refund_no`)
- UNIQUE KEY `uk_refund_id` (`refund_id`)
- KEY `idx_order_id` (`order_id`)
- KEY `idx_payment_id` (`payment_id`)
- KEY `idx_status` (`status`)

---

### 3.8 员工表 (staff)

**表描述**: 码头工作人员账号表

| 字段名       | 类型         | 长度 | 允许NULL | 默认值 | 索引 | 说明                                  |
| ------------ | ------------ | ---- | -------- | ------ | ---- | ------------------------------------- |
| id           | INT          | -    | NO       | -      | PK   | 员工ID，主键，自增                    |
| username     | VARCHAR      | 32   | NO       | -      | UNI  | 用户名（登录账号）                    |
| password     | VARCHAR      | 128  | NO       | -      | -    | 密码（bcrypt 加密）                   |
| real_name    | VARCHAR      | 32   | NO       | -      | -    | 真实姓名                              |
| phone        | VARCHAR      | 20   | YES      | NULL   | IDX  | 手机号                                |
| role         | VARCHAR      | 20   | NO       | staff  | IDX  | 角色（staff:员工, admin:管理员）      |
| is_active    | TINYINT      | 1    | NO       | 1      | -    | 是否启用（0:禁用, 1:启用）            |
| last_login_at| DATETIME     | -    | YES      | NULL   | -    | 最后登录时间                          |
| is_deleted   | TINYINT      | 1    | NO       | 0      | -    | 软删除标记                            |
| created_at   | DATETIME     | -    | NO       | -      | -    | 创建时间                              |
| updated_at   | DATETIME     | -    | NO       | -      | -    | 更新时间                              |

**索引**:
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_username` (`username`)
- KEY `idx_phone` (`phone`)
- KEY `idx_role` (`role`)

**初始数据示例**:
```sql
-- 默认管理员账号（密码: admin123）
INSERT INTO staff (username, password, real_name, role) VALUES
('admin', '$2b$10$...bcrypt_hash...', '系统管理员', 'admin');

-- 默认员工账号（密码: staff123）
INSERT INTO staff (username, password, real_name, role) VALUES
('staff01', '$2b$10$...bcrypt_hash...', '张三', 'staff');
```

---

### 3.9 核销记录表 (verification_logs)

**表描述**: 记录所有核销操作（发船、收船）

| 字段名          | 类型         | 长度 | 允许NULL | 默认值 | 索引 | 说明                                  |
| --------------- | ------------ | ---- | -------- | ------ | ---- | ------------------------------------- |
| id              | BIGINT       | -    | NO       | -      | PK   | 核销记录ID，主键，自增                |
| order_id        | BIGINT       | -    | NO       | -      | IDX  | 关联订单ID                            |
| staff_id        | INT          | -    | NO       | -      | IDX  | 关联员工ID                            |
| boat_id         | INT          | -    | YES      | NULL   | -    | 关联船只ID                            |
| action_type     | VARCHAR      | 20   | NO       | -      | IDX  | 操作类型（start:发船, end:收船）      |
| scan_time       | DATETIME     | -    | NO       | -      | -    | 扫码时间                              |
| remark          | VARCHAR      | 512  | YES      | NULL   | -    | 备注（异常情况说明）                  |
| created_at      | DATETIME     | -    | NO       | -      | IDX  | 创建时间                              |

**索引**:
- PRIMARY KEY (`id`)
- KEY `idx_order_id` (`order_id`)
- KEY `idx_staff_id` (`staff_id`)
- KEY `idx_action_type` (`action_type`)
- KEY `idx_created_at` (`created_at`)

---

### 3.10 计时记录表 (timing_records)

**表描述**: 记录每笔订单的计时详情（用于对账和审计）

| 字段名          | 类型         | 长度   | 允许NULL | 默认值 | 索引 | 说明                                  |
| --------------- | ------------ | ------ | -------- | ------ | ---- | ------------------------------------- |
| id              | BIGINT       | -      | NO       | -      | PK   | 计时记录ID，主键，自增                |
| order_id        | BIGINT       | -      | NO       | -      | UNI  | 关联订单ID（一对一关系）              |
| boat_id         | INT          | -      | NO       | -      | IDX  | 关联船只ID                            |
| start_time      | DATETIME     | -      | NO       | -      | -    | 开始计时时间                          |
| end_time        | DATETIME     | -      | YES      | NULL   | -    | 结束计时时间                          |
| used_seconds    | INT          | -      | YES      | NULL   | -    | 实际使用秒数（精确计时）              |
| used_minutes    | INT          | -      | YES      | NULL   | -    | 实际使用分钟数（向上取整）            |
| overtime_minutes| INT          | -      | YES      | NULL   | -    | 超时分钟数                            |
| overtime_fee    | DECIMAL      | (10,2) | YES      | NULL   | -    | 超时费用（元）                        |
| is_abnormal     | TINYINT      | 1      | NO       | 0      | IDX  | 是否异常（0:正常, 1:异常，如超24小时）|
| created_at      | DATETIME     | -      | NO       | -      | -    | 创建时间                              |
| updated_at      | DATETIME     | -      | NO       | -      | -    | 更新时间                              |

**索引**:
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_order_id` (`order_id`)
- KEY `idx_boat_id` (`boat_id`)
- KEY `idx_is_abnormal` (`is_abnormal`)

---

## 4. 数据字典汇总

### 4.1 订单状态 (orders.status)

| 状态值     | 说明                     | 允许的下一状态                          |
| ---------- | ------------------------ | --------------------------------------- |
| pending    | 待支付                   | paid, cancelled                         |
| paid       | 已支付，待核销           | verified, cancelled                     |
| verified   | 已核销，待发船           | timing                                  |
| timing     | 计时中（游玩中）         | ended, timeout                          |
| ended      | 已结束计时，待结算       | completed                               |
| completed  | 已完成（已退款）         | -                                       |
| cancelled  | 已取消                   | -                                       |
| timeout    | 超时异常（超24小时未收船）| completed                               |

### 4.2 支付状态 (payments.status)

| 状态值   | 说明       |
| -------- | ---------- |
| pending  | 待支付     |
| success  | 支付成功   |
| failed   | 支付失败   |

### 4.3 退款状态 (refunds.status)

| 状态值   | 说明       |
| -------- | ---------- |
| pending  | 待退款     |
| success  | 退款成功   |
| failed   | 退款失败   |

### 4.4 船只状态 (boats.status)

| 状态值       | 说明       |
| ------------ | ---------- |
| idle         | 空闲       |
| in_use       | 使用中     |
| maintenance  | 维护中     |

### 4.5 核销操作类型 (verification_logs.action_type)

| 类型值 | 说明       |
| ------ | ---------- |
| start  | 发船       |
| end    | 收船       |

### 4.6 员工角色 (staff.role)

| 角色值 | 说明       | 权限                                 |
| ------ | ---------- | ------------------------------------ |
| staff  | 普通员工   | 扫码核销、发船、收船、船号查询       |
| admin  | 管理员     | 所有员工权限 + 强制结束订单、查看报表 |

---

## 5. 索引策略

### 5.1 高频查询索引
- `orders.user_id` - 用户查询自己的订单列表
- `orders.order_no` - 通过订单号查询订单
- `orders.verification_code` - 员工扫码核销
- `orders.status` - 按状态筛选订单（如查询所有"计时中"的订单）
- `boats.boat_number` - 通过船号查询船只信息
- `boats.status` - 查询空闲船只

### 5.2 联合索引（待优化）
如果后期发现某些联合查询频繁，可以添加联合索引：
- `orders (user_id, status, created_at)` - 用户订单列表分页查询
- `verification_logs (order_id, action_type)` - 查询订单的发船/收船记录

---

## 6. 数据安全与备份

### 6.1 数据加密
- **敏感字段**: 用户手机号、员工密码需加密存储
- **密码策略**: 使用 bcrypt 哈希算法，加盐存储

### 6.2 数据备份
- **全量备份**: 每天凌晨3点自动全量备份
- **增量备份**: 每小时增量备份 binlog
- **备份保留**: 保留最近30天的备份

### 6.3 数据恢复
- **故障恢复**: 使用全量备份 + binlog 增量恢复
- **误删恢复**: 软删除策略，重要数据不物理删除

---

## 7. 性能优化建议

### 7.1 分库分表（扩展性考虑）
如果订单量增长到千万级别，可以考虑：
- **订单表分表**: 按月分表（如 orders_202601, orders_202602）
- **历史数据归档**: 1年前的订单迁移到归档库

### 7.2 读写分离
- **主库**: 处理写操作（创建订单、更新状态）
- **从库**: 处理读操作（查询订单列表、报表统计）

### 7.3 缓存策略
- **热点数据**: 价格配置、船型列表缓存到 Redis
- **订单状态**: 计时中的订单缓存到 Redis，减少数据库查询
- **缓存失效**: 配置更新时主动删除缓存

---

## 8. 下一步

请参考 [建表SQL脚本](./schema.sql) 执行数据库初始化。

---

**文档结束**
