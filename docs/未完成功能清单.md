# 景区游船项目 - 未完成功能清单

## 检查时间
2024-02-04 17:45

## ❌ 未完成的功能

### 1. 支付页面（payment）⚠️ 高优先级

**状态**：页面文件存在但内容为空

**问题**：
- `pages/payment/payment.wxml` 只有一行占位文本
- `pages/payment/payment.js` 只有默认模板代码

**需要开发**：
- [ ] 订单信息展示
- [ ] 支付金额显示
- [ ] 微信支付调用（模拟支付）
- [ ] 支付成功后的处理
- [ ] 生成核销码

**预计时间**：2小时

---

### 2. 订单列表云函数（getOrderList）⚠️ 高优先级

**状态**：目录存在但代码为空

**问题**：
- `cloudfunctions/getOrderList/` 目录为空
- order-list 页面调用时报错

**需要开发**：
- [ ] 创建 index.js
- [ ] 创建 package.json
- [ ] 查询用户的订单列表
- [ ] 支持分页
- [ ] 按时间倒序排列

**预计时间**：1小时

---

### 3. 订单列表页面适配（order-list）⚠️ 高优先级

**状态**：页面已开发，但使用旧的 API 方式

**问题**：
- 使用 `api.get('/order/list')` 而不是云函数
- 需要改用 `cloud.callFunction()`

**需要修改**：
- [ ] 修改 order-list.js 使用云函数
- [ ] 移除对 api.js 的依赖
- [ ] 测试分页加载

**预计时间**：0.5小时

---

### 4. 订单详情页面（order-detail）🔍 待检查

**状态**：需要检查是否完整

**需要检查**：
- [ ] 页面是否已开发
- [ ] 是否使用云函数
- [ ] 功能是否完整

**预计时间**：0.5-1小时

---

### 5. 船型图片上传 ⚠️ 需要配合

**状态**：测试数据中的图片URL是占位符

**问题**：
- 图片URL：`cloud://your-env-id.xxx/boat-images/double.jpg`
- 云存储中没有实际图片
- 控制台报错 500

**解决方案**：
**方案A**：上传真实图片到云存储（推荐）
- [ ] 准备船型图片（双人船、四人船、六人船）
- [ ] 上传到云存储 `/boat-images/` 目录
- [ ] 更新数据库中的图片URL

**方案B**：使用占位图标（临时）
- [ ] 修改代码，图片加载失败时显示默认图标
- [ ] 或者暂时隐藏图片

**方案C**：使用网络图片（不推荐）
- [ ] 使用外部图片链接

**预计时间**：
- 方案A：需要您准备图片，技术实现 0.5小时
- 方案B：0.5小时
- 方案C：0.2小时

---

### 6. 其他控制台错误修复 🔧

**getUserProfile 错误**：
- 这是遗留的登录相关代码
- 需要清理 app.js 中的相关代码

**预计时间**：0.2小时

---

## ✅ 已完成的功能

### 用户端小程序
- [x] 首页 - 船型列表展示
- [x] 船型详情展示
- [x] 创建订单功能
- [ ] 支付页面（未完成）
- [ ] 订单列表（需要适配云函数）
- [ ] 订单详情（待检查）

### 员工端小程序
- [x] 员工登录
- [x] 扫码核销
- [x] 开始计时
- [x] 结束计时
- [x] 船号反查
- [x] 待处理订单列表

### 云函数
- [x] getBoatTypes - 获取船型列表
- [x] createOrder - 创建订单
- [ ] getOrderList - 获取订单列表（未完成）
- [x] getOrderDetail - 获取订单详情
- [x] scanCode - 扫码核销
- [x] startTrip - 开始计时
- [x] endTrip - 结束计时
- [x] staffLogin - 员工登录
- [x] findByBoatNumber - 船号反查
- [x] getPendingOrders - 待处理订单列表

### 数据库
- [x] 7个集合已创建
- [x] 测试数据已导入（boatTypes, pricingConfigs, boats, staff）

---

## 📅 明天晚上完成计划

### 优先级排序

**P0 - 核心功能（必须完成）**
1. ✅ 支付页面 - 2小时
2. ✅ getOrderList 云函数 - 1小时
3. ✅ order-list 页面适配 - 0.5小时
4. ✅ order-detail 页面检查修复 - 1小时

**P1 - 重要功能（建议完成）**
5. ✅ 图片问题处理 - 0.5小时（方案B：占位图）
6. ✅ 控制台错误修复 - 0.2小时

**P2 - 优化功能（时间允许）**
7. ⏸️ 上传真实船型图片（需要您配合提供图片）
8. ⏸️ 完善错误提示
9. ⏸️ 添加加载动画

**总计时间**：约 5.2 小时

---

## 🚨 需要您配合的事项

### 1. 图片准备（如果使用方案A）
- 双人船图片（建议尺寸：750×500px）
- 四人船图片（建议尺寸：750×500px）
- 六人船图片（建议尺寸：750×500px）

### 2. 支付功能说明
**问题**：正式的微信支付需要企业资质和配置

**解决方案**：
- **方案A**：模拟支付（点击按钮直接支付成功）- 推荐用于测试
- **方案B**：对接真实微信支付 - 需要：
  - 企业微信支付商户号
  - 支付密钥
  - 额外开发时间：2-3小时

**建议**：先用模拟支付完成功能测试，后续再对接真实支付

---

## 🎯 明天的工作计划

### 上午（9:00-12:00）
1. 开发 getOrderList 云函数
2. 适配 order-list 页面
3. 检查和修复 order-detail 页面

### 下午（14:00-18:00）
4. 开发 payment 支付页面
5. 处理图片加载问题
6. 修复所有控制台错误
7. 完整流程测试

### 晚上（19:00-22:00）
8. 完善细节和用户体验
9. 全功能测试
10. 修复测试中发现的问题

---

## ⚡ 立即要做的（现在开始）

1. **创建 getOrderList 云函数** - 解决订单列表错误
2. **修复图片加载问题** - 暂时使用占位方案
3. **清理登录相关错误** - 移除 getUserProfile 调用

这些可以在今晚完成，减轻明天的工作量。

---

## 📊 完成度统计

- **整体完成度**：约 75%
- **用户端**：60%
- **员工端**：90%
- **云函数**：85%
- **数据库**：100%
