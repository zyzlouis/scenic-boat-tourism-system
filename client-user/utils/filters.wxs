// utils/filters.wxs - 公共格式化工具

/**
 * 格式化金额
 */
function formatMoney(amount) {
  if (amount === null || amount === undefined || amount === '') {
    return '0.00';
  }
  var num = parseFloat(amount);
  if (isNaN(num)) {
    return '0.00';
  }
  return num.toFixed(2);
}

/**
 * 格式化时间
 */
function formatTime(dateStr) {
  if (!dateStr) return '';

  var date = getDate(dateStr);
  var year = date.getFullYear();
  var month = ('0' + (date.getMonth() + 1)).slice(-2);
  var day = ('0' + date.getDate()).slice(-2);
  var hour = ('0' + date.getHours()).slice(-2);
  var minute = ('0' + date.getMinutes()).slice(-2);
  var second = ('0' + date.getSeconds()).slice(-2);

  return year + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second;
}

/**
 * 格式化时长
 */
function formatDuration(minutes) {
  if (!minutes || minutes === 0) return '0分钟';

  var hours = Math.floor(minutes / 60);
  var mins = minutes % 60;

  if (hours > 0) {
    return hours + '小时' + mins + '分钟';
  }
  return mins + '分钟';
}

/**
 * 获取订单状态文本
 */
function getOrderStatusText(status) {
  var statusMap = {
    'pending': '待支付',
    'paid': '待核销',
    'verified': '待发船',
    'timing': '计时中',
    'ended': '结算中',
    'completed': '已完成',
    'cancelled': '已取消',
    'timeout': '超时异常'
  };
  return statusMap[status] || '未知状态';
}

/**
 * 获取订单状态颜色
 */
function getOrderStatusColor(status) {
  var colorMap = {
    'pending': '#ff9800',
    'paid': '#2196f3',
    'verified': '#2196f3',
    'timing': '#4caf50',
    'ended': '#9c27b0',
    'completed': '#9e9e9e',
    'cancelled': '#f44336',
    'timeout': '#f44336'
  };
  return colorMap[status] || '#999999';
}

module.exports = {
  formatMoney: formatMoney,
  formatTime: formatTime,
  formatDuration: formatDuration,
  getOrderStatusText: getOrderStatusText,
  getOrderStatusColor: getOrderStatusColor
};
